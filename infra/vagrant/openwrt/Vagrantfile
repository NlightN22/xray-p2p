# frozen_string_literal: true

BOX_PATH = File.expand_path('../boxes/openwrt-24.10.2.box', __dir__)
PROJECT_ROOT = File.expand_path('../../..', __dir__)
BUILD_OUTPUT = File.join(PROJECT_ROOT, 'build', 'openwrt')
HOST_IP = ENV.fetch('OPENWRT_HOST_IP', '10.0.10.30')
HOST_NETMASK = ENV.fetch('OPENWRT_HOST_NETMASK', '255.255.255.0')
HOST_INTERFACE = ENV.fetch('OPENWRT_HOST_INTERFACE', 'eth1')

Vagrant.configure('2') do |config|
  config.vm.box = 'openwrt-24.10.2'
  config.vm.box_url = BOX_PATH
  config.vm.hostname = 'openwrt-server'

  config.ssh.insert_key = false
  config.vm.boot_timeout = 200
  config.vm.synced_folder '.', '/vagrant', disabled: true

  config.vm.network 'forwarded_port', guest: 22, host: 2222, auto_correct: true
  config.vm.network 'private_network', ip: HOST_IP, auto_config: false

  config.vm.provider 'virtualbox' do |vb|
    vb.name = 'openwrt-24.10.2-server'
    vb.gui = false
  end

  config.vm.provision 'file',
                      source: BUILD_OUTPUT,
                      destination: '/tmp/build-openwrt'
end
